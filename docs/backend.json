{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Stores user profile and company settings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account, matches Auth UID."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "companyName": {
          "type": "string",
          "description": "Name of the user's company."
        },
        "defaultTaxRate": {
            "type": "number",
            "description": "Default tax rate for proposals."
        },
        "fixedOverhead": {
            "type": "number",
            "description": "Fixed overhead percentage."
        },
        "desiredProfitMargin": {
            "type": "number",
            "description": "Desired profit margin percentage."
        }
      },
      "required": [
        "id",
        "email",
        "companyName"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Stores customer contact information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the UserProfile who owns this customer."
        },
        "name": {
          "type": "string",
          "description": "Customer's full name."
        },
        "email": {
          "type": "string",
          "description": "Customer's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Customer's phone number."
        },
        "address": {
          "type": "string",
          "description": "Customer's address."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "email"
      ]
    },
    "Proposal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Proposal",
      "type": "object",
      "description": "Stores proposal data.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the proposal."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer."
        },
         "customerName": {
          "type": "string",
          "description": "Denormalized customer name for easy display."
        },
        "createdAt": {
          "type": "object",
          "description": "Timestamp of when the proposal was created."
        },
        "status": {
          "type": "string",
          "description": "Status of the proposal (e.g., Draft, Sent, Accepted, Rejected).",
          "enum": ["Draft", "Sent", "Accepted", "Rejected"]
        },
        "amount": {
            "type": "number",
            "description": "Total amount of the proposal."
        }
      },
      "required": [
        "id",
        "userId",
        "customerId",
        "customerName",
        "createdAt",
        "status",
        "amount"
      ]
    },
    "PriceBookItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PriceBookItem",
      "type": "object",
      "description": "Stores individual entries for materials and equipment costs managed by the contractor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the price book entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile."
        },
        "name": {
          "type": "string",
          "description": "Name of the material or equipment."
        },
        "category": {
            "type": "string",
            "description": "Category of the item.",
            "enum": ["Material", "Equipment", "Labor"]
        },
        "cost": {
          "type": "number",
          "description": "Cost of the item."
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement (e.g., each, feet, hours)."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "category",
        "cost"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "rules": "rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n\n    // Deny all reads and writes by default.\n    match /{document=**} {\n      allow read, write: if false;\n    }\n\n    // User profiles can be read by anyone, but only written by the owner.\n    match /userAccounts/{userId} {\n      allow read: if true; \n      allow write: if request.auth.uid == userId;\n    }\n\n    // User-specific data can only be read and written by the owning user.\n    match /userAccounts/{userId}/{collection}/{docId} {\n      allow read, write: if request.auth.uid == userId;\n    }\n  }\n}",
    "structure": [
      {
        "path": "/userAccounts/{userAccountId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user account information. Path-based ownership for private user data."
        }
      },
      {
        "path": "/userAccounts/{userAccountId}/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer data related to a user account. Path-based ownership enforces that only the user can access their customers."
        }
      },
      {
        "path": "/userAccounts/{userAccountId}/proposals/{proposalId}",
        "definition": {
          "entityName": "Proposal",
          "schema": {
            "$ref": "#/backend/entities/Proposal"
          },
          "description": "Stores proposal data related to a user. Path-based ownership enforces that only the user can access their proposals."
        }
      },
      {
        "path": "/userAccounts/{userAccountId}/priceBookEntries/{priceBookEntryId}",
        "definition": {
          "entityName": "PriceBookItem",
          "schema": {
            "$ref": "#/backend/entities/PriceBookItem"
          },
          "description": "Stores price book entries related to a user account. Path-based ownership ensures that only the user can access their price book entries."
        }
      }
    ]
  }
}
